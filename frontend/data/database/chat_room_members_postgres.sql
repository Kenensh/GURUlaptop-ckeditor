-- PostgreSQL version of chat_room_members.sql

-- 如果表格已存在則刪除
DROP TABLE IF EXISTS public.chat_room_members CASCADE;

CREATE TABLE public.chat_room_members (
  id SERIAL PRIMARY KEY,
  room_id INTEGER NOT NULL,
  user_id INTEGER NOT NULL,
  joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create indexes
CREATE INDEX idx_chat_room_members_room_id ON public.chat_room_members(room_id);
CREATE INDEX idx_chat_room_members_user_id ON public.chat_room_members(user_id);

-- Insert data
INSERT INTO public.chat_room_members (id, room_id, user_id, joined_at) VALUES
(1, 1, 440, '2024-11-18 15:05:05'),
(2, 1, 441, '2024-11-18 15:07:31'),
(3, 2, 440, '2024-11-18 15:08:08'),
(4, 2, 441, '2024-11-18 15:08:36'),
(5, 3, 440, '2024-11-18 15:59:08'),
(6, 3, 441, '2024-11-18 16:00:30'),
(7, 4, 440, '2024-11-18 22:07:35'),
(8, 4, 441, '2024-11-18 22:17:10'),
(9, 5, 440, '2024-11-19 10:35:53'),
(10, 6, 440, '2024-11-19 11:52:35'),
(11, 7, 440, '2024-11-19 14:30:53'),
(12, 7, 441, '2024-11-19 14:32:45'),
(13, 8, 440, '2024-11-19 15:55:07'),
(14, 8, 441, '2024-11-19 15:56:40'),
(15, 9, 440, '2024-11-19 22:06:25'),
(16, 9, 441, '2024-11-19 22:21:38'),
(17, 10, 440, '2024-11-19 22:46:09'),
(18, 10, 441, '2024-11-19 22:46:47'),
(19, 11, 440, '2024-11-19 23:05:01'),
(20, 11, 441, '2024-11-19 23:05:25'),
(23, 11, 441, '2024-11-20 12:57:24'),
(24, 13, 440, '2024-11-20 12:59:36'),
(25, 13, 441, '2024-11-20 12:59:55'),
(26, 14, 440, '2024-11-20 13:03:09'),
(27, 15, 440, '2024-11-20 13:05:21'),
(28, 16, 440, '2024-11-20 13:13:07'),
(29, 17, 440, '2024-11-21 10:39:53'),
(30, 17, 441, '2024-11-21 10:40:17'),
(31, 18, 440, '2024-11-21 10:56:49'),
(32, 19, 443, '2024-11-21 13:17:28'),
(33, 19, 441, '2024-11-21 13:17:49'),
(34, 20, 440, '2024-11-21 17:02:15'),
(35, 20, 441, '2024-11-21 17:02:15'),
(36, 21, 440, '2024-11-23 15:39:07'),
(37, 21, 441, '2024-11-23 15:39:47'),
(38, 22, 440, '2024-11-24 18:08:31'),
(39, 22, 441, '2024-11-24 18:09:05'),
(40, 23, 449, '2024-11-24 18:09:32'),
(41, 24, 450, '2024-11-24 18:20:05'),
(42, 25, 451, '2024-11-24 18:42:54'),
(43, 25, 451, '2024-11-24 18:43:08'),
(44, 25, 450, '2024-11-24 18:45:36'),
(45, 26, 452, '2024-11-24 18:49:48'),
(46, 27, 452, '2024-11-24 22:51:59'),
(47, 27, 452, '2024-11-24 22:52:49'),
(48, 28, 453, '2024-11-24 22:59:13'),
(49, 28, 453, '2024-11-24 22:59:28'),
(50, 28, 452, '2024-11-24 22:59:30'),
(51, 29, 454, '2024-11-24 23:01:37'),
(52, 29, 454, '2024-11-24 23:01:52'),
(53, 29, 455, '2024-11-24 23:04:11'),
(54, 30, 455, '2024-11-24 23:06:14'),
(55, 30, 455, '2024-11-24 23:06:30'),
(56, 31, 457, '2024-11-24 23:11:59'),
(57, 31, 457, '2024-11-24 23:12:28'),
(58, 32, 456, '2024-11-24 23:12:19'),
(59, 32, 456, '2024-11-24 23:12:31');

-- Reset sequence to continue from the last id
-- 重置序列到下一個可用ID
DO $$
BEGIN
    PERFORM setval('chat_room_members_id_seq', COALESCE((SELECT MAX(id) FROM chat_room_members), 0) + 1, false);
END $$;
